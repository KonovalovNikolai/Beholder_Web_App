{% extends "base.html" %}

{% block styles %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.4.1/cropper.min.css"
          integrity="sha512-Yq9lAK/eVwL0/wCk3u2f5qtGqqrbm7fXNTjhzqwk8vyLp2UmNt79cGPgWyxyUB//AmCNN1d6od+PA+D+btyWjQ=="
          crossorigin="anonymous"/>
    <link rel="stylesheet" href="{{ url_for('static', filename='js/hystModal-0.4/dist/hystmodal.min.css') }}">
{% endblock %}

{% block modalWindow %}
    <div class="hystmodal" id="myModal" aria-hidden="true">
        <div class="hystmodal__wrap">
            <div class="hystmodal__window" role="dialog" aria-modal="true">
                <p>Изменить фото.</p>
                <input type="file" id="cropperfile"/>
                <div style="width:300px;height:400px;">
                    <img src="" id="cropper-img"/>
                </div>
                <button id="crop" action="{{ url_for('upload_avatar', user_id=user.id) }}">Загрузить</button>
            </div>
        </div>
    </div>
{% endblock %}

{% block content %}
    <h1>{{ user.get_fullname() }}: Редактирование профиля.</h1>
    <img src="{{ url_for('avatar', filename=user.get_avatar_name()) }}" alt="User avatar" id="avatar">
    <br>
    <button  id="new-avatr" data-hystmodal="#myModal">Изменить аватар.</button>
    <br>
    <p>Личная информация.</p>
    <form action="" method="POST">
        {{ profile_form.hidden_tag() }}
        {% for field in profile_form if field.name != "csrf_token"%}
            <p>{{ field.lable }}</p>
            <p>
                {{ field }}
                {% for error in field.errors %}
                    <span style="color: red;">{{ error }}</span>
                {% endfor %}
            </p>
        {% endfor %}
        <p><input type="submit" name="{{ profile_form.form_name }}" value="Редактировать"></p>
    </form>

    <p>Изменить пароль</p>
    <form action="" method="POST">
        {{ password_form.hidden_tag() }}
        {% for field in password_form if field.name != "csrf_token"%}
            <p>{{ field.lable }}</p>
            <p>
                {{ field }}
                {% for error in field.errors %}
                    <span style="color: red;">{{ error }}</span>
                {% endfor %}
            </p>
        {% endfor %}
        <p><input type="submit" name="{{ password_form.form_name }}" value="Изменить пароль"></p>
    </form>
{% endblock %}

{% block scripts %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"
            integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"
            integrity="sha512-uto9mlQzrs59VwILcLiRYeLKPPbS/bT71da/OEBYEwcdNUk8jYIy+D176RYoop1Da+f9mvkYrmj5MCLZWEtQuA=="
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"
            integrity="sha512-0bEtK0USNd96MnO4XhH8jhv3nyRF0eK87pJke6pkYf3cM0uDIhNJy9ltuzqgypoIFXw3JSuiy04tVk4AjpZdZw=="
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.4.1/cropper.min.js"
            integrity="sha512-QQWbg0x9wiAdLwLWfCmsGPq/KvjlrmVWzoB9bLT/JMYmr2kLRCLCvDkhhVWsdI3cjJQ2tFBPQVlGG/cgcC1DAA=="
            crossorigin="anonymous"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/cropper.js') }}"></script>
    <script src="{{ url_for('static', filename='js/hystModal-0.4/dist/hystmodal.min.js') }}"></script>
    <script>
        const myModal = new HystModal({
            linkAttributeName: "data-hystmodal",
            closeOnButton: false
        });
    </script>
{% endblock %}
